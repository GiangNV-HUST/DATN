!pragma charset UTF-8
@startuml multi_agent_workflow
!theme plain
skinparam backgroundColor #FFFFFF
skinparam shadowing false
skinparam defaultFontName "Times New Roman"

title Multi-Agent Workflow - Sequential & Parallel Execution

skinparam rectangle {
    BackgroundColor<<input>> #E8E8FF
    BackgroundColor<<router>> #FFECB3
    BackgroundColor<<agent>> #FFD6D6
    BackgroundColor<<parallel>> #D4EDDA
    BackgroundColor<<output>> #F0E6FF
    BorderColor #333333
    FontSize 10
}

' === SEQUENTIAL WORKFLOW ===
package "Sequential Workflow" as seq_title <<router>> {
    rectangle "Query:\n'Lọc P/E < 15 rồi\nphân tích chi tiết'" as seq_input <<input>>

    rectangle "ScreenerSpecialist\n(Task 1)" as seq_agent1 <<agent>>
    rectangle "AnalysisSpecialist\n(Task 2)" as seq_agent2 <<agent>>

    rectangle "Combined\nResponse" as seq_output <<output>>

    seq_input --> seq_agent1 : "1. Lọc cổ phiếu"
    seq_agent1 --> seq_agent2 : "2. Context: Danh sách\ncổ phiếu đã lọc"
    seq_agent2 --> seq_output : "3. Phân tích từng mã"
}

' === PARALLEL WORKFLOW ===
package "Parallel Workflow" as par_title <<parallel>> {
    rectangle "Query:\n'Tổng quan VN-Index\nvà khuyến nghị cổ phiếu'" as par_input <<input>>

    rectangle "MarketContext\nSpecialist" as par_agent1 <<agent>>
    rectangle "Discovery\nSpecialist" as par_agent2 <<agent>>

    rectangle "Merged\nResponse" as par_output <<output>>

    par_input --> par_agent1 : "Task 1\n(parallel)"
    par_input --> par_agent2 : "Task 2\n(parallel)"
    par_agent1 --> par_output
    par_agent2 --> par_output
}

note right of seq_title
  **Sequential Mode:**
  - Agent2 waits for Agent1
  - Context passed between agents
  - Use for dependent tasks

  **Example Patterns:**
  - Screen → Analyze
  - Analyze → Compare
  - Screen → Invest
end note

note right of par_title
  **Parallel Mode:**
  - Both agents run simultaneously
  - Results merged at end
  - Use for independent tasks

  **Example Patterns:**
  - Market || Discovery
  - Analysis || Comparison
end note

note bottom of seq_title
  **Multi-Model Support:**
  Each agent can use different models
  based on task complexity
end note

@enduml
