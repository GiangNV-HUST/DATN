!pragma charset UTF-8
@startuml sequence_uc6_phan_tich
!theme plain
skinparam backgroundColor #FEFEFE
skinparam shadowing false
skinparam defaultFontName "Times New Roman"

title UC6: PhÃ¢n tÃ­ch ká»¹ thuáº­t & tÃ i chÃ­nh (Stock Analysis)

actor User
participant "Root Agent" as Root
participant "Analysis Specialist" as Analysis
participant "Multi-Model System" as Models
participant "MCP Server" as MCP
database "PostgreSQL" as DB

== Initialization ==
User -> Root: "PhÃ¢n tÃ­ch cá»• phiáº¿u VCB"
activate Root
Root -> Analysis: Route to AnalysisSpecialist
activate Analysis

== Data Collection ==
Analysis -> MCP: Get stock data\n(VCB, 90 days)
activate MCP
MCP -> DB: Get price history & fundamentals
activate DB
DB --> MCP: 90-day OHLCV + indicators + financials
deactivate DB
MCP --> Analysis: Complete stock data
deactivate MCP

== Analysis ==
Analysis -> Models: Summarize data\n(Gemini Flash)
activate Models
Models --> Analysis: Data summary
deactivate Models

Analysis -> Models: Deep analysis\n(Claude Sonnet 4.5)
activate Models
Models -> Models: Technical analysis\nFundamental analysis\nValuation & recommendation
Models --> Analysis: Complete analysis report
deactivate Models

== Chart Generation ==
Analysis -> MCP: Generate analysis chart
activate MCP
MCP --> Analysis: Chart image with indicators
deactivate MCP

== Result ==
Analysis --> Root: Complete analysis package
deactivate Analysis
Root --> User: ðŸ“Š PhÃ¢n tÃ­ch VCB:\n\n**Ká»¹ thuáº­t:**\nâ€¢ Xu hÆ°á»›ng: TÄƒng (MA5>MA20)\nâ€¢ RSI: 58 (Neutral)\nâ€¢ MACD: Positive crossover\n\n**CÆ¡ báº£n:**\nâ€¢ PE: 12.5 (Há»£p lÃ½)\nâ€¢ ROE: 18% (Tá»‘t)\nâ€¢ EPS growth: +15%\n\nðŸ’¡ Khuyáº¿n nghá»‹: MUA\n[Chart attached]
deactivate Root

note over User, DB
  **Analysis Components:**
  â€¢ Technical: Price action, indicators, patterns
  â€¢ Fundamental: Financial ratios, growth metrics
  â€¢ Valuation: Fair price estimation
  â€¢ Chart: Visual representation

  **Multi-Model Usage:**
  â€¢ Gemini Flash: Fast data summarization
  â€¢ Claude Sonnet: Deep analysis & insights
end note

@enduml
