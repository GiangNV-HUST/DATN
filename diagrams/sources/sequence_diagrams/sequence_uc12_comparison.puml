!pragma charset UTF-8
@startuml sequence_uc12_comparison
!theme plain
skinparam backgroundColor #FEFEFE
skinparam shadowing false
skinparam defaultFontName "Times New Roman"

title UC12: So s√°nh c·ªï phi·∫øu (Stock Comparison)

actor User
participant "Root Agent" as Root
participant "Comparison Specialist" as Comparison
participant "Multi-Model System" as Models
participant "MCP Server" as MCP
database "PostgreSQL" as DB

== Initialization ==
User -> Root: "So s√°nh VCB v√† TCB"
activate Root
Root -> Root: Extract symbols: [VCB, TCB]
Root -> Comparison: Route to ComparisonSpecialist
activate Comparison

== Data Gathering ==
Comparison -> MCP: Get comparison data\n(VCB, TCB)
activate MCP
MCP -> DB: Get stock details, indicators, predictions
activate DB
DB --> MCP: ‚Ä¢ Fundamentals (PE, ROE, EPS)\n‚Ä¢ Technical (RSI, MACD, MA)\n‚Ä¢ 3-day predictions
deactivate DB
MCP --> Comparison: Complete data for both stocks
deactivate MCP

== Analysis ==
Comparison -> Models: Summarize data\n(Gemini Flash)
activate Models
Models --> Comparison: Structured comparison table
deactivate Models

Comparison -> Models: Analyze & recommend\n(GPT-4o)
activate Models
Models -> Models: Compare metrics\nDetermine winner\nInvestment advice
Models --> Comparison: Comparison report with recommendation
deactivate Models

== Result ==
Comparison --> Root: Complete comparison
deactivate Comparison
Root --> User: ‚öñÔ∏è So s√°nh VCB vs TCB:\n\n**C∆° b·∫£n:**\nVCB: PE 12.5 | ROE 18%\nTCB: PE 10.8 | ROE 15%\n\n**K·ªπ thu·∫≠t:**\nVCB: RSI 58 | Uptrend\nTCB: RSI 62 | Neutral\n\n**D·ª± ƒëo√°n 3 ng√†y:**\nVCB: +2.5% | TCB: +1.8%\n\nüí° Khuy·∫øn ngh·ªã: VCB
deactivate Root

note over User, DB
  **Comparison Metrics:**
  ‚Ä¢ Fundamental: PE, ROE, EPS, Revenue growth
  ‚Ä¢ Technical: RSI, MACD, MA trends
  ‚Ä¢ Price prediction: 3-day forecast
  ‚Ä¢ Liquidity: Volume & trading activity

  **Multi-Model Usage:**
  ‚Ä¢ Gemini Flash: Data summarization
  ‚Ä¢ GPT-4o: Comparison analysis & recommendation
end note

@enduml
