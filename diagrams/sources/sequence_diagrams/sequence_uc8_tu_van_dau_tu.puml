!pragma charset UTF-8
@startuml sequence_uc8_tu_van_dau_tu
!theme plain
skinparam backgroundColor #FEFEFE
skinparam shadowing false
skinparam defaultFontName "Times New Roman"

title UC8: T∆∞ v·∫•n ƒë·∫ßu t∆∞ (Investment Advisory)

actor User
participant "Root Agent" as Root
participant "Investment Planner" as Planner
participant "Multi-Model System" as Models
participant "MCP Server" as MCP
database "PostgreSQL" as DB

== Initialization ==
User -> Root: "T∆∞ v·∫•n danh m·ª•c 500tr, r·ªßi ro TB"
activate Root
Root -> Planner: Route to InvestmentPlanner
activate Planner

== Phase 1: Profile Analysis ==
Planner -> MCP: Get user profile
activate MCP
MCP -> DB: Query user data
activate DB
DB --> MCP: Risk: Medium, Capital: 500M
deactivate DB
MCP --> Planner: Profile data
deactivate MCP

Planner -> Models: Analyze profile\n(Gemini Flash)
activate Models
Models --> Planner: Investment goals identified
deactivate Models

== Phase 2: Stock Discovery ==
Planner -> MCP: Search potential stocks\n(PE < 15, ROE > 15%)
activate MCP
MCP -> DB: Filter stocks
activate DB
DB --> MCP: 45 candidates
deactivate DB
MCP --> Planner: Stock list
deactivate MCP

Planner -> Models: Filter & rank stocks\n(Claude Sonnet 4.5)
activate Models
Models --> Planner: Top 12 stocks
deactivate Models

== Phase 3: Deep Analysis ==
Planner -> MCP: Get detailed data\n(6 selected stocks)
activate MCP
MCP -> DB: Fetch OHLCV + fundamentals
activate DB
DB --> MCP: Historical data
deactivate DB
MCP --> Planner: Stock data
deactivate MCP

Planner -> Models: Analyze 6 stocks\n(Claude Sonnet 4.5)
activate Models
Models --> Planner: Analysis reports
deactivate Models

== Phase 4: Portfolio Construction ==
Planner -> MCP: Calculate optimal allocation\n(Markowitz)
activate MCP
MCP --> Planner: Weights: [20%, 18%, 17%, 16%, 15%, 14%]
deactivate MCP

Planner -> Models: Generate strategy\n(GPT-4o)
activate Models
Models --> Planner: ‚Ä¢ Portfolio allocation\n‚Ä¢ Entry strategy (DCA)\n‚Ä¢ Risk management
deactivate Models

== Result ==
Planner --> Root: Investment plan
deactivate Planner
Root --> User: üìä K·∫ø ho·∫°ch ƒë·∫ßu t∆∞:\n\n6 c·ªï phi·∫øu: VCB, HPG, VHM...\nV·ªën ph√¢n b·ªï: 500M VND\nChi·∫øn l∆∞·ª£c: DCA 3 th√°ng\nK·ª≥ v·ªçng: +15-20%/nƒÉm
deactivate Root

note over User, DB
  **Multi-Model Workflow:**
  ‚Ä¢ Gemini Flash: Quick data processing
  ‚Ä¢ Claude Sonnet: Deep analysis & filtering
  ‚Ä¢ GPT-4o: Creative strategy generation

  **Portfolio Optimization:**
  ‚Ä¢ Markowitz Mean-Variance
  ‚Ä¢ Risk-adjusted returns
  ‚Ä¢ Diversification constraints
end note

@enduml
