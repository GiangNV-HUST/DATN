!pragma charset UTF-8
@startuml comparison_specialist_multi_model
!theme plain
skinparam backgroundColor #FFFFFF
skinparam shadowing false
skinparam defaultFontName "Times New Roman"

title Comparison Specialist - Multi-Model Architecture

skinparam rectangle {
    BackgroundColor<<input>> #E8E8FF
    BackgroundColor<<agent>> #D4EDDA
    BackgroundColor<<model>> #E1F5FE
    BackgroundColor<<tool>> #FFF3CD
    BackgroundColor<<output>> #F0E6FF
    BorderColor #333333
    FontSize 10
}

rectangle "User Query\n(So s√°nh VCB vs TCB)" as input <<input>>

package "ComparisonSpecialist" as agent <<agent>> {
    rectangle "compare(symbols)" as compare <<tool>>
    rectangle "_gather_comparison_data()" as gather <<tool>>
    rectangle "_build_comparison_table()" as table <<tool>>
}

package "MCP Tools" as mcp {
    rectangle "get_stock_details_from_tcbs" as details <<tool>>
    rectangle "get_technical_indicators" as tech <<tool>>
    rectangle "get_stock_price_prediction" as predict <<tool>>
}

rectangle "GPT-4o\n(Comparison Analysis)" as gpt <<model>>
rectangle "Gemini 2.0 Flash\n(Data Collection)" as gemini <<model>>

rectangle "Response\n(Comparison Table + Ranking)" as output <<output>>

input --> agent : "Extract symbols"

agent --> gather : "Parallel data fetch"
gather --> details : "Price, fundamentals"
gather --> tech : "RSI, MACD, MA"
gather --> predict : "3-day prediction"

gather --> gemini : "Collect & summarize"
gemini --> table : "Structured data"

agent --> table : "Build comparison"
table --> gpt : "Analysis prompt"

gpt --> output

note right of agent
  **Comparison Criteria:**
  - Price & Change %
  - P/E, P/B, ROE, ROA
  - RSI, MACD signals
  - Prediction trend
  - Trading volume
end note

note right of gpt
  **GPT-4o:**
  - Creative comparison
  - Winner per metric
  - Investment advice
end note

note right of gemini
  **Gemini 2.0 Flash:**
  - Fast data gathering
  - Parallel processing
  - Cost-efficient
end note

note bottom of output
  **Output Format:**
  - Side-by-side table
  - Winner per metric
  - Overall recommendation
  - Investment suggestion
end note

@enduml
